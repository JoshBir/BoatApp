import { Project } from '../types';
import { v4 as uuidv4 } from 'uuid';

// Pre-built boat wiring diagram template matching user's setup
export const boatDiagramTemplate: Omit<Project, 'id' | 'createdAt' | 'updatedAt'> = {
  name: 'Boat Solar + DC-DC System',
  description: 'Complete boat wiring with dual solar panels, Renogy DCC30S, starter and house batteries',
  systemVoltage: 12,
  nodes: [
    // Solar Panel 1
    {
      id: 'solar-1',
      type: 'solar-panel',
      position: { x: 100, y: 50 },
      data: {
        spec: {
          id: 'solar-panel',
          type: 'solar-panel',
          category: 'power-source',
          name: 'Solar Panel',
          icon: '‚òÄÔ∏è',
          description: '12V marine solar panel',
          voltage: 12,
          wattage: 100,
          voc: 22,
          isc: 6,
          vmp: 18,
          imp: 5.56,
          customizable: ['wattage', 'voc', 'isc', 'name'],
        },
        label: 'Solar 100W',
        customValues: { wattage: 100 },
        warnings: [],
        errors: [],
      },
    },
    // Solar Panel 2
    {
      id: 'solar-2',
      type: 'solar-panel',
      position: { x: 300, y: 50 },
      data: {
        spec: {
          id: 'solar-panel',
          type: 'solar-panel',
          category: 'power-source',
          name: 'Solar Panel',
          icon: '‚òÄÔ∏è',
          description: '12V marine solar panel',
          voltage: 12,
          wattage: 100,
          voc: 22,
          isc: 6,
          vmp: 18,
          imp: 5.56,
          customizable: ['wattage', 'voc', 'isc', 'name'],
        },
        label: 'Solar 100W',
        customValues: { wattage: 100 },
        warnings: [],
        errors: [],
      },
    },
    // 25A Solar Fuse
    {
      id: 'fuse-solar',
      type: 'fuse',
      position: { x: 100, y: 180 },
      data: {
        spec: {
          id: 'fuse',
          type: 'fuse',
          category: 'protection',
          name: 'Fuse',
          icon: '‚ö°',
          description: 'Inline fuse',
          voltage: 12,
          rating: 25,
          customizable: ['rating', 'name'],
        },
        label: '25A Fuse',
        customValues: { rating: 25 },
        warnings: [],
        errors: [],
      },
    },
    // Renogy DCC30S
    {
      id: 'renogy-dcc30s-1',
      type: 'renogy-dcc30s',
      position: { x: 200, y: 280 },
      data: {
        spec: {
          id: 'renogy-dcc30s',
          type: 'dc-dc-mppt-charger',
          category: 'charging',
          name: 'Renogy DCC30S',
          icon: 'üîÑ‚òÄÔ∏è',
          description: '12V 30A Dual Input DC-DC On-Board Battery Charger with MPPT',
          voltage: 12,
          chargeRate: 30,
          efficiency: 98,
          alternatorInputMin: 8,
          alternatorInputMax: 16,
          solarInputMin: 9,
          solarInputMax: 32,
          maxSolarWattage: 400,
          maxSolarCurrent: 30,
          maxCurrent: 30,
          batteryTypes: ['AGM', 'GEL', 'Flooded', 'Lithium (LiFePO4)', 'Calcium'],
          selfConsumption: 10,
          operatingTemp: '-40¬∞C to +85¬∞C',
          dimensions: '215 x 185 x 73 mm',
          weight: 1.6,
          customizable: ['name'],
        },
        label: 'Renogy 30A DC-DC',
        customValues: {},
        warnings: [],
        errors: [],
      },
    },
    // 40A Fuse - Starter Side
    {
      id: 'fuse-starter',
      type: 'fuse',
      position: { x: 80, y: 420 },
      data: {
        spec: {
          id: 'fuse',
          type: 'fuse',
          category: 'protection',
          name: 'Fuse',
          icon: '‚ö°',
          description: 'Inline fuse',
          voltage: 12,
          rating: 40,
          customizable: ['rating', 'name'],
        },
        label: '40A Fuse',
        customValues: { rating: 40 },
        warnings: [],
        errors: [],
      },
    },
    // 40A Fuse - House Side
    {
      id: 'fuse-house',
      type: 'fuse',
      position: { x: 400, y: 420 },
      data: {
        spec: {
          id: 'fuse',
          type: 'fuse',
          category: 'protection',
          name: 'Fuse',
          icon: '‚ö°',
          description: 'Inline fuse',
          voltage: 12,
          rating: 40,
          customizable: ['rating', 'name'],
        },
        label: '40A Fuse',
        customValues: { rating: 40 },
        warnings: [],
        errors: [],
      },
    },
    // 100A ANL Fuse - Starter Battery
    {
      id: 'anl-starter',
      type: 'anl-fuse',
      position: { x: 30, y: 520 },
      data: {
        spec: {
          id: 'anl-fuse',
          type: 'anl-fuse',
          category: 'protection',
          name: 'ANL Fuse',
          icon: 'üî∂',
          description: 'High-current ANL fuse',
          voltage: 12,
          rating: 100,
          customizable: ['rating', 'name'],
        },
        label: '100A Fuse',
        customValues: { rating: 100 },
        warnings: [],
        errors: [],
      },
    },
    // 120A ANL Fuse - House Battery
    {
      id: 'anl-house',
      type: 'anl-fuse',
      position: { x: 450, y: 520 },
      data: {
        spec: {
          id: 'anl-fuse',
          type: 'anl-fuse',
          category: 'protection',
          name: 'ANL Fuse',
          icon: 'üî∂',
          description: 'High-current ANL fuse',
          voltage: 12,
          rating: 120,
          customizable: ['rating', 'name'],
        },
        label: '120A Fuse',
        customValues: { rating: 120 },
        warnings: [],
        errors: [],
      },
    },
    // Starter Battery (Lead Acid)
    {
      id: 'battery-starter',
      type: 'battery',
      position: { x: 50, y: 620 },
      data: {
        spec: {
          id: 'battery',
          type: 'battery',
          category: 'power-source',
          name: 'Battery',
          icon: 'üîã',
          description: '12V marine battery',
          voltage: 12,
          capacity: 100,
          customizable: ['capacity', 'name'],
        },
        label: 'Starter Lead Acid',
        customValues: { capacity: 100 },
        warnings: [],
        errors: [],
      },
    },
    // House Battery (280Ah Lithium)
    {
      id: 'battery-house',
      type: 'battery',
      position: { x: 380, y: 620 },
      data: {
        spec: {
          id: 'battery',
          type: 'battery',
          category: 'power-source',
          name: 'Battery',
          icon: 'üîã',
          description: '12V marine battery',
          voltage: 12,
          capacity: 280,
          customizable: ['capacity', 'name'],
        },
        label: '280Ah Lithium',
        customValues: { capacity: 280 },
        warnings: [],
        errors: [],
      },
    },
    // 70A Alternator
    {
      id: 'alternator-1',
      type: 'alternator',
      position: { x: 50, y: 780 },
      data: {
        spec: {
          id: 'alternator',
          type: 'alternator',
          category: 'power-source',
          name: 'Alternator',
          icon: '‚ö°',
          description: 'Engine alternator',
          voltage: 14.4,
          maxCurrent: 70,
          customizable: ['maxCurrent', 'name'],
        },
        label: '70A Alternator',
        customValues: { maxCurrent: 70 },
        warnings: [],
        errors: [],
      },
    },
    // Positive Bus Bar
    {
      id: 'bus-positive',
      type: 'bus-bar',
      position: { x: 550, y: 650 },
      data: {
        spec: {
          id: 'bus-bar',
          type: 'bus-bar',
          category: 'distribution',
          name: 'Bus Bar',
          icon: '‚ïê‚ïê‚ïê',
          description: 'Power distribution bus bar',
          voltage: 12,
          maxCurrent: 150,
          customizable: ['maxCurrent', 'name', 'terminals'],
        },
        label: 'PV + Bus',
        customValues: {},
        warnings: [],
        errors: [],
      },
    },
    // Negative Bus Bar
    {
      id: 'bus-negative',
      type: 'ground-bus',
      position: { x: 550, y: 750 },
      data: {
        spec: {
          id: 'ground-bus',
          type: 'ground-bus',
          category: 'ground',
          name: 'Ground Bus',
          icon: '‚îÅ‚îÅ‚îÅ',
          description: 'Negative ground bus bar',
          voltage: 0,
          maxCurrent: 200,
          customizable: ['name', 'terminals'],
        },
        label: 'NV - Bus',
        customValues: {},
        warnings: [],
        errors: [],
      },
    },
  ],
  edges: [
    // Solar 1 to Solar Fuse
    {
      id: 'e-solar1-fuse',
      source: 'solar-1',
      target: 'fuse-solar',
      sourceHandle: 'positive',
      targetHandle: 'in',
      type: 'smoothstep',
      animated: true,
      style: { stroke: '#dc2626', strokeWidth: 2 },
    },
    // Solar 2 to Solar Fuse (parallel connection via solar 1)
    {
      id: 'e-solar2-solar1',
      source: 'solar-2',
      target: 'solar-1',
      sourceHandle: 'positive',
      targetHandle: 'positive',
      type: 'smoothstep',
      animated: true,
      style: { stroke: '#dc2626', strokeWidth: 2 },
    },
    // Solar Fuse to Renogy PV+
    {
      id: 'e-fuse-renogy-pv',
      source: 'fuse-solar',
      target: 'renogy-dcc30s-1',
      sourceHandle: 'out',
      targetHandle: 'pv-pos',
      type: 'smoothstep',
      animated: true,
      style: { stroke: '#f97316', strokeWidth: 2 },
    },
    // Renogy Starter output to 40A Fuse
    {
      id: 'e-renogy-fuse-starter',
      source: 'renogy-dcc30s-1',
      target: 'fuse-starter',
      sourceHandle: 'starter-batt',
      targetHandle: 'in',
      type: 'smoothstep',
      animated: true,
      style: { stroke: '#eab308', strokeWidth: 2 },
    },
    // 40A Fuse to 100A ANL
    {
      id: 'e-fuse40-anl100',
      source: 'fuse-starter',
      target: 'anl-starter',
      sourceHandle: 'out',
      targetHandle: 'in',
      type: 'smoothstep',
      animated: true,
      style: { stroke: '#dc2626', strokeWidth: 3 },
    },
    // 100A ANL to Starter Battery
    {
      id: 'e-anl-starter-batt',
      source: 'anl-starter',
      target: 'battery-starter',
      sourceHandle: 'out',
      targetHandle: 'positive-in',
      type: 'smoothstep',
      animated: true,
      style: { stroke: '#dc2626', strokeWidth: 3 },
    },
    // Renogy House output to 40A Fuse
    {
      id: 'e-renogy-fuse-house',
      source: 'renogy-dcc30s-1',
      target: 'fuse-house',
      sourceHandle: 'aux-batt',
      targetHandle: 'in',
      type: 'smoothstep',
      animated: true,
      style: { stroke: '#22c55e', strokeWidth: 2 },
    },
    // 40A Fuse to 120A ANL
    {
      id: 'e-fuse40-anl120',
      source: 'fuse-house',
      target: 'anl-house',
      sourceHandle: 'out',
      targetHandle: 'in',
      type: 'smoothstep',
      animated: true,
      style: { stroke: '#dc2626', strokeWidth: 3 },
    },
    // 120A ANL to House Battery
    {
      id: 'e-anl-house-batt',
      source: 'anl-house',
      target: 'battery-house',
      sourceHandle: 'out',
      targetHandle: 'positive-in',
      type: 'smoothstep',
      animated: true,
      style: { stroke: '#dc2626', strokeWidth: 3 },
    },
    // Alternator to Starter Battery
    {
      id: 'e-alt-starter',
      source: 'alternator-1',
      target: 'battery-starter',
      sourceHandle: 'positive-out',
      targetHandle: 'positive-in',
      type: 'smoothstep',
      animated: true,
      style: { stroke: '#dc2626', strokeWidth: 3 },
    },
    // House Battery to Positive Bus
    {
      id: 'e-house-bus-pos',
      source: 'battery-house',
      target: 'bus-positive',
      sourceHandle: 'positive-out',
      targetHandle: 'in',
      type: 'smoothstep',
      animated: true,
      style: { stroke: '#dc2626', strokeWidth: 2 },
    },
    // Starter Battery to Negative Bus
    {
      id: 'e-starter-bus-neg',
      source: 'battery-starter',
      target: 'bus-negative',
      sourceHandle: 'negative-out',
      targetHandle: 'in1',
      type: 'smoothstep',
      animated: true,
      style: { stroke: '#1d4ed8', strokeWidth: 2 },
    },
    // House Battery to Negative Bus
    {
      id: 'e-house-bus-neg',
      source: 'battery-house',
      target: 'bus-negative',
      sourceHandle: 'negative-out',
      targetHandle: 'in2',
      type: 'smoothstep',
      animated: true,
      style: { stroke: '#1d4ed8', strokeWidth: 2 },
    },
  ],
};

export function createBoatDiagramProject(): Project {
  return {
    ...boatDiagramTemplate,
    id: uuidv4(),
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
  } as Project;
}
